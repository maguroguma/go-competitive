# 全方位木DP

Last Change: 2020-07-18 17:07:38.

実際にやってみると意外とかんたん。

## 手順

1. 適当に根を決めてDFSしながら部分木に対して木DPを行う、答えを保持しておく。
2. `func dfs2(cid, pid, d_par)` のようなシグニチャで各ノードの答えを確定させるDFSを行う。
3. `cid` については、親から渡された `d_par` および自身の子に対する `dp` の結果を利用して答えを求める。
4. 答えを求めた後は、各子ノードに対する `d_par` を計算しつつ、さらなる `dfs2` のコールにおいてその値を渡してやる。
5. 3に戻る。子がなくなるまで続ける。

## コツ

難しい（面倒）なのは、結局 `d_par` を求める部分だと思う。

左・右累積XXXを事前計算しておくことで、逆元が定義できなくてもモノイドなら何でも高速に計算できる、という感じだと思う。
このあたりの計算は番兵を仕込むなりしてもう少しきれいに書けないか考えたい。

## 抽象化

未定。

## 参考

- [ei1333さんのブログ1](https://ei1333.hateblo.jp/entry/2017/04/10/224413)
- [ei1333さんのブログ2](https://ei1333.hateblo.jp/entry/2018/12/21/004022)
- [keymoonさんの全方位木DP抽象化の記事](https://qiita.com/keymoon/items/2a52f1b0fb7ef67fb89e)

# 強連結成分分解

Last Change: 2020-11-01 01:58:42.

ACLに入っていたので、インターフェースだけでも理解する。

## 参考

- [強連結成分分解＆トポロジカルソート](https://hcpc-hokudai.github.io/archive/graph_scc_001.pdf)
  - すごい力作に見える。

## ACLの概要

Goの移植版については[EmptyBoxさんのこちら](https://qiita.com/EmptyBox_0/items/2f8e3cf7bd44e0f789d5#scc)を拝借する。

- 構造体を `new` したあとはそこに一つ一つ有向辺を足していくような形で構築していく。
- `Scc` メソッドで、強連結成分分解が得られる。
- 強連結成分一つ一つのnode idリストの順番は不定。
- 強連結成分の順序はトポロジカルソートされて出力される。

---

## 準備: トポロジカルソートのDFSによる求め方

「すべての頂点からDFSして、帰りがけ順に出力したものを最後にリバースしてやれば、それがトポロジカル順序」というだけ。  
当然ながら、一度訪問した頂点は以降はスキップして良い。

知識としては重要だが、以下の理由からBFS版でいいと思う。

- 再帰よりは非再帰の方がわずかながら早い？
  - 言語によっては再帰の深さ制限に引っかかる可能性があるので、そちらの方が深刻かもしれない。
- **閉路検出を考える場合は、DFSの方は少し工夫が必要になる。**
  - DAGだと保証されているのならDFSでいいのかも？
  - 訪問済みかどうかの情報を単にboolで持っておくと不十分で、おそらくは「何回目のDFSか？」という整数値が必要になると思う。

## 定義

有効グラフGの頂点の部分集合をSとする。

- Sが強連結である: Sに含まれる任意2頂点 `u, v` を取ったとき `u -> v` と到達できる。
  - 「任意の2頂点」であることを見逃さないように。
  - Sに含まれない頂点を経由しても問題ない（と思われる）
- Sが強連結成分である: 強連結な集合Sに、他のどの頂点集合を付け加えても強連結にならない。
  - つまりは、 **「極大の強連結な頂点集合」** と言えそう。

**「強連結」のほうが「強連結成分」よりも広義** と言えそう。

## 強連結成分とは

**全ての強連結成分を、1つの頂点に塗りつぶすことである。**

これによって、DAGでないグラフをDAGとして扱えるようになる（※可能性がある、ぐらいのはず）。

## 強連結成分のアルゴリズム

要約すると「DFSしてから、辺を逆にして特定の順序でもう一回DFSする」となる。

1. 適当な頂点からDFSをし、帰りがけ順に番号を振る。
まだ通っていない頂点がある場合、再びそこからDFSを行う。
2. 辺を全て逆向きにし、 **1で降った番号が一番大きい頂点から順番に** 2回目のDFSを始める。
**このDFSによって通ることが出来た頂点が1つの強連結成分（もしくはただ1つの頂点）となる。**
まだ通っていない頂点があれば、その中で番号が一番大きなところから再びDFSをする。

ポイントは以下。

1回目のDFS後、強連結成分を「除く」と、番号が大きい順にトポロジカル順序になる。  
よって、逆辺にすると、自分より若い頂点に行くことができなくなる。  
**ただし、強連結成分は辺を逆にしても強連結成分なので、強連結成分内ではその中では訪れることができる。**


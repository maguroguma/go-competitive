# Nimというゲームについて

Last Change: 2020-10-15 23:18:28.

ARC105で自分が解くべき範囲に出題されてしまったので、基本を抑えておく。

## 参考

- [ニム（複数山の石取りゲーム）の必勝法 - 高校数学の美しい物語](https://mathtrain.jp/nim)
  - Nimの必勝法と勝利判定だけなら、この記事のニム和（XOR和）の知識だけで良い。
- [競プロにおけるNim、Grundy数とNimK](http://yang33-kassa.hatenablog.com/entry/2017/12/21/202812)
  - Grundy数も履修するとなると、このような記事も参照する必要がある。
- [Grundy数（Nim数, Nimber）の理論](https://www.creativ.xyz/grundy-number-1065/)
  - ふるやんさんの記事だが、力作ということで一時期話題になっていた、気がする。

---

## 問題例

- [ARC013 C.笑いをとれるかな？](https://atcoder.jp/contests/arc013/tasks/arc013_3)
  - 豆腐1つが実は6つの石の山に相当するNimになる。
- [ARC105 D.Let's Play Nim](https://atcoder.jp/contests/arc105/tasks/arc105_d)
  - Nimの盤面をプレイヤーが作っていくことになるが、実は最適手を考えると限られた行動にしかならない。

---

## Nimとは

変種は色々あるが、基本は以下のようなもの。

- 二人で行うゲーム。
- いくつかの山にいくつかの石がある。
- プレーヤーは交互に石を取っていく。このとき **同時に取れるのは同じ山の石のみ、かつ、一回で1個以上最大何個でも取れる。**
- **最後の石を取った方が勝ち。**

### 勝利判定

**各山の石の数のXORを取ったとき、0ならば先手の負け、非0ならば先手の勝ち。**

### なぜか？

まず、石が0個の状態で手番が回ってきたら負けてしまうが、この時の状態は「XOR和が0の状態」といえる。  
これを踏まえて、「1.XORが非0のときに常に相手の手番にXORが0の状態で渡すことが出来て、また、
2.相手がXORが0の状態からこちらに手番が渡ってくるときはXORが非0の状態にできる」ことが証明できれば良い。

1については、「XORの最上位の1となっているビットについて、その数の石を持つ山を選ぶ」ことで達成できる。  
なぜなら、その山には下位のビットを自由に操作するための十分な数の石があるからである。

以降ではXORのことをニム和と呼ぶ。

例えば、 `X = (10101)` という山があり、ニム和が `S = (10000)` だったとする。  
このとき `X` の山を除いたニム和は `S^X = (00101)` となる。  
これを0にするためにXOR加算する場合、 `Y = (00101)` を選べば良い。  
今 `Y < X` なので、このような石のとり方があるといえる。  
※雑なイメージで言うと、桁DPで上位桁を小さくしてしまえば、以降の下位桁を自由に選べる、というアレを利用している。

また、2については、1つの山のビットしかいじれず、またどこかのビットはいじらないといけないことを考えると、
ほとんど自明である。

---

## Grundy数について

WIP...


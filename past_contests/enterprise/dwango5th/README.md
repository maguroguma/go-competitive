# 第5回ドワンゴからの挑戦状予選 過去問感想

Last Change: 2020-03-08 14:00:41.

## C問題（@2020-03-08）

解けなかったけど、かなり学びのある数え上げだったと思う。

残業後に解説ブログとかを読んだら全く理解できなかったが、休日にゆっくりと整理したらとても素直な解法だった。

参考: [ツバサさんのブログ解説](https://emtubasa.hateblo.jp/entry/2018/11/25/213000)

公式PDFの解説も本質はしっかりと解説されているが、細部（といっても自明なのだが）が端折られていて
ちょっと分かりづらかった。
ツバサさんのブログは数え上げの気持ち部分も少し書いてくださっているので、わかりやすかった。

ツバサさんの解説では累積和を使っているが、固定長のスライディングウィンドウ内の
「必要なもの」を正しく管理しておけば、先頭と末尾の調整だけで済むので、必ずしも累積和は必要でない。

競プロの定石に「3者のうち真ん中に着目する」というのがあるが、今回はそれは難しい（そのような解法もあるのかもしれないが）。
固定長の区間を扱う場合は、「スライドさせて、適宜流入・流出をうまく扱う」という方がうまくいくのだろうか？
このあたりはまだ経験値が足りないのでわからない。

結論から言うと、区間に関して以下のデータを保持しておけば良い。

1.区間内の `D` の個数
2.区間内の `M` の個数
3.区間内の `DM` の個数

答えを計算するために、末尾で `C` に当たるたびに、3の個数を加算すればよい、ということは簡単にわかる。
問題は、区間のスライドごとにどうやって正しく3を更新すればよいのか、ということ。
これを適切に行うために、1,2の数値も保持しておく必要がある。

そのためには、以下が大事な観察となる。

- 区間から外れるものが `D` だった場合、その `D` が無効化する `DM` の個数は、区間内の `M` の個数に等しい。
  - よって、そのような場合は `DM` の個数から `M` の個数を引く。
- 区間に新たに入ってくるものが `M` だった場合、その `M` が新たに `DM` を作ることになるが、その個数は `D` に等しい。
  - よって、そのような場合は `DM` の個数に `D` の個数を足す。

ここに注意すれば正しく実装できるはずだが、これと区間内の `D`, `M` の個数を更新するのは若干思考のレベルが違うため、
うっかりミスをしやすい気がする。

そう考えると、区間の初期化はともかく、区間のスライド部分での区間内の `D`, `M` の数を数える部分は、
累積和に任せたほうがバグの可能性は小さいかもしれない。


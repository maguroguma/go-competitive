# トポロジカルソートについて

## 参考

- [ferin氏のブログ記事](https://ferin-tech.hatenablog.com/entry/2017/01/24/184750)
  - 要点と、入次数を見た手法、DFSによる手法、応用例、例題などが簡潔にまとまっている。
- [動的計画法入門](slideshare.net/kakira9618/an-introduction-to-dynamic-programming-30163243)
  - kakiraさんのスライド、DAGと動的計画法の関係について詳しく説明されている。

## 概要

> 閉路がない有向グラフの各有向辺が順方向になるようにソートすることをトポロジカルソートと呼びます。
> DAG（有向無閉路グラフ）にのみ行うことができ、トポロジカルソートが行えればそのグラフはDAGであると言えます。

「グラフがDAGである」と「グラフについてトポロジカルソートができる」は同値と考えて良さそう。

## アルゴリズム

### 入次数に着目するやり方

各ノードの入次数を予め計算しておき、入次数0のものをスタックに積んでいく。
スタックからLIFOで取り出したノードを答えに追加していくことで、トポロジカルソートされた配列が出来上る。
スタックが空になるまで続ける。

計算量は、すべてのノードが1回ずつスタックに追加される可能性があり、
それぞれについて遷移先すべてを見ることになるので `O(|V| + |E|)` となる。

**閉路検出ができるメリットが有る（DFSではできない？）。**
スタックのループを抜けた後に、結果配列の長さがノードの数と一致していない場合、
トポロジカルソートは失敗している（DAGではなく、閉路が合った）。
これは、閉路に着目すると、閉路を形成するノードが循環参照となっており、
すなわち閉路を形成するノードについては入次数が0になることがなく、スタックに追加されることがないため。

アルゴリズムの全体イメージとしては、入次数が0になったノード＝前の依存関係が解決済み（前にあるべきノードはすでに結果に収まっている）なので、
そういったノードを順番に処理していく形。

スタックを使っているので、本質的にはDFSと同じかも。

### DFSで再帰関数を用いるやり方

すべてのノードについてDFSを行って、「**帰りがけ順で**」結果に格納していくことで、
トポロジカルソートの逆順が形成される。

行きがけ順がダメなのはわかる（注目している起点の前に、更に先に結果に収まるべきノードが存在する可能性があるので）が、
帰りがけ順でうまくいくのは面白い。

実際に簡単なDAGを書いて、アルゴリズムの動きをトレースしてみるとよく分かる。

計算量は、グラフのDFSによる全探索と考えれば良いので `O(|V| + |E|)` となる。

#### DFSの閉路検出

できなくはなさそうだがちょっとややこしい印象。

参考: [ABC139E問題の解説放送](https://youtu.be/UWbGRhF3Ozw?t=7395)

